# Настройка разрешений в manifest.json для прохождения проверок

## Текущие разрешения

### 1. Основные разрешения (permissions)
```json
"permissions": [
  "storage",           // Доступ к локальному хранилищу
  "tabs",              // Доступ к информации о вкладках
  "activeTab",         // Доступ к активной вкладке
  "https://api.telegram.org/*",  // Telegram API
  "https://www.avito.ru/*",      // Avito сайт
  "https://*/v1/*",              // LLM API (HTTPS)
  "http://*/v1/*"                // LLM API (HTTP)
]
```

### 2. Разрешения хостов (host_permissions)
```json
"host_permissions": [
  "https://*/*",       // Все HTTPS сайты
  "http://*/*"         // Все HTTP сайты
]
```

## Важные моменты для прохождения проверок

### 1. Обоснование широких разрешений

Для работы с LLM API расширение должно иметь возможность подключаться к различным серверам:

- **Локальные серверы**: `http://192.168.0.116:1234`
- **Облачные серверы**: `https://api.openai.com`
- **Самодельные серверы**: `https://custom-llm-server.com`

### 2. Альтернативные варианты разрешений

#### Более ограниченный вариант:
```json
"host_permissions": [
  "https://*/v1/*",
  "http://*/v1/*",
  "https://api.openai.com/*",
  "https://api.anthropic.com/*"
]
```

#### Конкретные серверы:
```json
"host_permissions": [
  "https://192.168.0.116:1234/*",
  "https://api.openai.com/*",
  "https://api.anthropic.com/*"
]
```

### 3. Документирование в описании

Обновите описание расширения для объяснения необходимости широких разрешений:

```json
"description": "Отслеживает изменения на страницах Avito, анализирует объявления через LLM API и отправляет уведомления в Telegram. Требует доступ к LLM серверам для интеллектуальной фильтрации объявлений."
```

## Рекомендации для публикации

### 1. Chrome Web Store
- **Объясните необходимость** широких разрешений в описании
- **Укажите конкретные серверы** в host_permissions если возможно
- **Добавьте скриншоты** интерфейса с настройками LLM API

### 2. Firefox Add-ons
- **Используйте минимальные разрешения** для начала
- **Добавьте host_permissions** только для необходимых доменов
- **Объясните в описании** зачем нужны разрешения

### 3. Альтернативный подход
Можно сделать разрешения более конкретными:

```json
"host_permissions": [
  "https://*/v1/chat/completions",
  "https://api.openai.com/v1/*",
  "https://api.anthropic.com/v1/*"
]
```

## Проверка разрешений

### 1. Тестирование
```javascript
// Проверка доступности URL
fetch('https://example.com/v1/chat/completions')
  .then(response => console.log('Доступен:', response.status))
  .catch(error => console.log('Недоступен:', error));
```

### 2. Отладка
- Откройте Developer Tools
- Проверьте вкладку Network на наличие блокированных запросов
- Проверьте консоль на CORS ошибки

## Безопасность

### 1. Принцип минимальных привилегий
- Используйте только необходимые разрешения
- Документируйте каждое разрешение
- Объясните пользователю зачем нужны разрешения

### 2. Прозрачность
- Показывайте пользователю, к каким серверам подключается расширение
- Логируйте все запросы к внешним API
- Предоставляйте возможность отключить LLM анализ

## Примеры для разных случаев

### Для локального сервера:
```json
"host_permissions": [
  "http://192.168.0.116:1234/*",
  "https://api.telegram.org/*"
]
```

### Для облачных сервисов:
```json
"host_permissions": [
  "https://api.openai.com/*",
  "https://api.anthropic.com/*",
  "https://api.telegram.org/*"
]
```

### Для универсального использования:
```json
"host_permissions": [
  "https://*/*",
  "http://*/*"
]
```

## Заключение

Текущая конфигурация с `"https://*/*"` и `"http://*/*"` обеспечивает максимальную совместимость с различными LLM серверами, но может вызвать вопросы при проверке. Рекомендуется:

1. **Документировать необходимость** широких разрешений
2. **Предоставить альтернативные варианты** для конкретных серверов
3. **Объяснить пользователю** зачем нужны разрешения
4. **Использовать принцип минимальных привилегий** где возможно
