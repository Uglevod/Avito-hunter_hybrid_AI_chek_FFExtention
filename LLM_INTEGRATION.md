# Интеграция с LLM API

## Обзор изменений

Плагин Avito Hunter был расширен для интеграции с LLM API (OpenAI-like) для автоматического анализа объявлений перед отправкой в Telegram.

## Новые функции

### 1. Поля настройки LLM API
- **Адрес LLM API**: поле для ввода URL сервера (например, `https://server.com/v1`)
- **Токен LLM API**: опциональное поле для API токена
- **Системный промпт**: текстовое поле для настройки промпта анализа

### 2. Автоматический анализ объявлений
- Каждое новое объявление анализируется через LLM API
- Ожидаемый формат ответа: `{"good": true}` или `{"good": false}`
- Если LLM возвращает `{"good": true}` - объявление отправляется в Telegram
- Если LLM возвращает `{"good": false}` - объявление не отправляется
- Если ответ не соответствует ожидаемому формату - отправляется весь текст ответа

### 3. Задержка между запросами
- Реализована задержка в 1 секунду между запросами к LLM API
- Предотвращает перегрузку API сервера

### 4. Загрузка системного промпта
- Системный промпт загружается из файла `sysPrompt`
- Пользователь может изменить промпт через интерфейс
- Кнопка "Сохранить промпт" для сохранения изменений

## Технические детали

### Особенности работы с LLM API
- Поддерживает OpenAI-compatible API
- Автоматическая обработка ошибок API
- Graceful fallback при недоступности API

### Формат запроса к LLM
```json
{
  "model": "gpt-3.5-turbo",
  "messages": [
    {
      "role": "system",
      "content": "системный промпт"
    },
    {
      "role": "user", 
      "content": "данные объявления"
    }
  ],
  "temperature": 0.1,
  "max_tokens": 100
}
```

### Обработка ответов
- Парсинг JSON ответа от LLM
- Проверка наличия поля `good` с булевым значением
- Fallback на отправку полного текста при неожиданном формате

## Настройка

1. Откройте popup расширения
2. Заполните поля:
   - Адрес LLM API (например, `https://api.openai.com/v1`)
   - Токен API (если требуется)
3. Настройте системный промпт или используйте стандартный
4. Нажмите "Сохранить промпт"
5. Запустите отслеживание как обычно

## Файлы изменены

- `manifest.json` - добавлены разрешения для LLM API
- `popup.html` - добавлены поля настройки LLM
- `popup.js` - логика работы с новыми полями
- `background.js` - интеграция с LLM API
- `sysPrompt` - файл с системным промптом по умолчанию

## Обратная совместимость

Если LLM API не настроен, расширение работает в обычном режиме - отправляет все найденные объявления в Telegram.
